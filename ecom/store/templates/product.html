{% extends 'base.html' %} {% block content %}

<br /><br />

<div class="container" style="flex: 1;">
  <div class="card mb-3">
    <div class="row g-0">
      <div class="col-md-4">
        <img
          src="{{ products.image.url }}"
          class="img-fluid rounded-start"
          alt="..."
        />
      </div>
      <div class="col-md-8">
        <div class="card-body">
          <h5 class="card-title text-center">{{ products.p_name }}</h5>
          <p class="card-title text-center">{{products.description}}</p>
          <br />
          {% if products.is_sale %}
          <div class="d-flex justify-content-center small text-warning mb-2">
            <div class="bi-star-fill"></div>
            &nbsp;&nbsp;Sale!!&nbsp;&nbsp;
            <!-- <div class="bi-star-fill"></div> -->
          </div>

          <!-- Product price-->
          <p class="text-center">
            <strike>₹{{products.price}}</strike>&nbsp;₹{{products.sale_price}}
          </p>

          {% else %} ₹{{products.price}} {% endif %}
          <br /><br />
          <div class="row justify-content-center" id="qty-cart">
            <!-- <div class="col-md-2">Quantity:</div>
            <div class="col-md-2">
              <select class="form-select" id="Quantity_option">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </div> -->
            <div class="col-md-2"><b>Quantity:</b></div>
            <div class="col-md-2">
              <select class="form-select" id="Quantity_option">
              </select>
          </div>
          </div>
          <br /><br />
          <p style="text-align: center;"><b>Price to Bid:</b>&nbsp; &nbsp;<input type="number" id="bidAmount"></p>
          <br /><br />
          <div class="row justify-content-center" id="address">
            <!-- <div class="col-md-2">Shipping Address:</div>
            <div class="col-md-2">
              <select class="form-select" id="Address_option">
                <option value="1">Home</option>
                <option value="2">Office</option>
                <option value="3">Other</option>
              </select>
            </div> -->
          </div>
          <!-- <div class="text-center">
            <button
              type="submit"
              class="btn btn-secondary"
              value="{{ products.id }}"
              id="add-cart"
            >
              Add to cart
            </button>
            <button
              type="submit"
              class="btn btn-secondary"
              value="{{ products.id }}"
              id="buy"
            >
              Buy
            </button>
          </div> -->
          <div style="text-align: center;">
            <button type="button" class="btn btn-primary" style="margin-top: 4%;">Add to Cart</button>
            <button type="button" class="btn btn-primary" style="margin-top: 4%;" id="sendRequests" onclick="sendRequests()">Request to Buy</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- <script>
    $(document).on("click", "#buy", function (e) {
      e.preventDefault();
      $.ajax({
        type: "POST",
        url: "localhost:8000/buy/",
        data: {
          product_id: $("#buy").val(),
          product_qty: $("#buy option:selected").text(),
          address: $("#address option:selected").text(),

          csrfmiddlewaretoken: "{{ csrf_token }}",
          action: "post",
        },
        success: function (json) {
          console.log(json);
          // document.getElementById("cart_quantity").innerText = json.qty;
        },
        error: function (xhr, errmsg, err) {
          // Handle error if needed
          console.log(err);
        },
      });
    });

    $(document).on("click", "#add-cart", function (e) {
      e.preventDefault();
      $.ajax({
        type: "POST",
        url: "cart_add/",
        data: {
          product_id: $("#add-cart").val(),
          product_qty: $("#qty-cart option:selected").text(),
          csrfmiddlewaretoken: "{{ csrf_token }}",
          action: "post",
        },
        success: function (json) {
          console.log(json);
          document.getElementById("cart_quantity").innerText = json.qty;
        },
        error: function (xhr, errmsg, err) {
          // Handle error if needed
        },
      });
    });
  </script> -->

  <script>
     var n = '{{ products.quantity }}';

// Get a reference to the select element
var selectElement = document.getElementById('Quantity_option');

// Loop from 1 to n to generate dropdown options
for (var i = 1; i <= n; i++) {
    // Create an option element
    var optionElement = document.createElement('option');

    // Set the value and text of the option
    optionElement.value = i;
    optionElement.textContent = i;

    // Append the option to the select element
    selectElement.appendChild(optionElement);
}
    var productId = '{{ products.id }}';
    // Function to send both POST and GET requests
    function sendRequests() {
      // Get the selected values
      
      var quantityValue = document.getElementById("Quantity_option").value;
      // var addressValue = document.getElementById("Address_option").value;
      var bidAmount = document.getElementById("bidAmount").value;
      // if(addressValue==1){
      //   addressopt="Home";
      // }
      // else if(addressValue==2){
      //   addressopt="Office";
      // }
      // else{
      //   addressopt="Other";
      // }
      
      // Object to be sent with the POST request
      var postData = {
        bid_amount:bidAmount,
        product_id: productId,
        product_qty: quantityValue,
        csrfmiddlewaretoken: '{{ csrf_token }}'
        // Add more key-value pairs as needed
      };
      console.log(postData)
  
      // Send POST request with the postData object
      $.post('{%url "buy" %}', postData, function(data, status) {
        console.log("POST request status: " + status);
        // Handle response if needed
      });
  
      // Send GET request
      // $.get("#", function(data, status) {
      //   console.log("GET request status: " + status);
      //   // Handle response if needed
      // });
    }
  </script>
</div>
{% endblock %}
